/*! @locomotivemtl/charcoal-admin 19-01-2017 */
$.fn.enable=function(){return this.each(function(){$(this).removeAttr("disabled").prop("disabled",!1)}),this},$.fn.disable=function(){return this.each(function(){$(this).attr("disabled",!0).prop("disabled",!0)}),this},Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){"use strict";if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b=Object(this),c=b.length>>>0,d=arguments[1],e=0;e!==c;e++)if(a.call(d,this[e],e,b))return this[e]}});var Charcoal=Charcoal||{};Charcoal.Admin=function(){"use strict";function a(){}var b,c,d;return b={base_url:null,admin_path:null},a.cachePool={},a.lang=document.documentElement.lang,a.defaultLang="en",a.set_lang=function(b){return a.lang=b||document.documentElement.lang||a.defaultLang,a.lang},a.set_data=function(a){b=$.extend(!0,b,a)},a.admin_url=function(){return b.base_url+b.admin_path+"/"},a.base_url=function(){return b.base_url},a.manager=function(){return"undefined"==typeof c&&(c=new Charcoal.Admin.ComponentManager),c},a.queryParams=function(){var a=location.search.slice(1).split("&"),b={};return a.forEach(function(a){a=a.split("="),a[1]&&(b[a[0]]=decodeURIComponent(a[1]||""))}),JSON.parse(JSON.stringify(b))},a.feedback=function(){return"undefined"==typeof d&&(d=new Charcoal.Admin.Feedback),arguments.length&&d.push.apply(d,arguments),d},a.get_object_name=function(a){var b=a.split("/");return b=b.splice(2,b.length),b.forEach(function(a,b,c){var d=a.split("-");d.length>1&&(d.forEach(function(a,b){d[b]=a.charAt(0).toUpperCase()+a.slice(1)}),a=d.join("_")),c[b]=a.charAt(0).toUpperCase()+a.slice(1)}),a=b.join("_")},a.parseNumber=function(a){var b=/^(\-|\+)?([0-9]+(\.[0-9]+)?|Infinity)$/;return b.test(a)?Number(a):a},a.loadScript=function(a,b){this.cache(a,function(b){$.ajax({url:a,dataType:"script",success:b.resolve,error:b.reject})}).then(b)},a.cache=function(a,b,c){return this.cachePool[a]||"function"==typeof b&&(this.cachePool[a]=$.Deferred(function(a){b(a)}).promise()),"function"==typeof this.cachePool[a]?this.cachePool[a].done(c):this.cachePool[a]},a.parseJqXhrArgs=function(){var a={failed:!0,jqXHR:null,textStatus:"",errorThrown:"",response:null};return arguments[2]&&"string"===$.type(arguments[2])?(a.jqXHR=arguments[0]||null,a.textStatus=arguments[1]||null,a.errorThrown=arguments[2]||null,a.response=arguments[3]||a.jqXHR.responseJSON||null,"object"===$.type(a.response)?a.failed=!a.response.success:a.failed=!0):(a.response=arguments[0]||null,a.textStatus=arguments[1]||null,a.jqXHR=arguments[2]||null,a.errorThrown=null,null===a.response&&(a.response=a.jqXHR.responseJSON),"object"===$.type(a.response)?a.failed=!a.response.success:a.failed=!1),a},a}(),function(a,b,c){"use strict";var d=a(b),e=a.Deferred(),f=1,g=function(){this.isReady=!1,this.components={},d.on("ready",a.proxy(this.render,this))};g.prototype.add_property_input=function(a){this.add_component("property_inputs",a)},g.prototype.add_widget=function(a){this.add_component("widgets",a)},g.prototype.add_template=function(a){this.add_component("templates",a)},g.prototype.add_component=function(a,b){var c=Charcoal.Admin.get_object_name(b.type);"function"==typeof Charcoal.Admin[c]?(b.ident=c,this.components[a]=this.components[a]||[],this.components[a].push(b)):console.error("Was not able to store "+c+" in "+a+" sub-array")},g.prototype.get_property_input=function(a){return this.get_component("property_inputs",a)},g.prototype.get_widget=function(a){return this.get_component("widgets",a)},g.prototype.get_template=function(a){return this.get_component("templates",a)},g.prototype.get_component=function(a,b){if(!this.isReady)throw new Error("Components must be rendered.");return a in this.components?this.components[a].find(function(a){return a._id===b}):c},g.prototype.ready=function(a){return e.promise().done(a),this},g.prototype.render=function(){var b=a.Event("render.charcoal.components",{relatedTarget:this});if(d.trigger(b),!b.isDefaultPrevented()){for(var c in this.components){var g=Charcoal;switch(c){case"widgets":g=Charcoal.Admin.Widget;break;case"property_inputs":g=Charcoal.Admin.Property;break;case"templates":g=Charcoal.Admin.Template}for(var h=0,i=this.components[c].length;h<i;h++){var j=this.components[c][h];if(j instanceof g)"function"==typeof j.destroy&&(j.destroy(),j.init());else try{var k=new Charcoal.Admin[j.ident](j);switch(this.components[c][h]=k,c){case"widgets":Charcoal.Admin.Widget.call(k,j),k.init()}}catch(a){console.error("Was not able to instanciate "+j.ident),console.error(a)}}}if(this.isReady)return this;if(this.isReady=!0,!(--f>0)){e.resolveWith(this);var l=a.Event("rendered.charcoal.components",{relatedTarget:this});return d.trigger(l),this}}},g.prototype.prepare_submit=function(){return this.prepare_inputs(),this.prepare_widgets(),!0},g.prototype.prepare_inputs=function(){var a="undefined"!=typeof this.components.property_inputs?this.components.property_inputs:[];if(!a.length)return!0;for(var b,c=a.length,d=0;d<c;d++)b=a[d],"function"==typeof b.validate&&b.validate();for(var e=0;e<c;e++)b=a[e],"function"==typeof b.save&&b.save();return!0},g.prototype.prepare_widgets=function(){var a="undefined"!=typeof this.components.widgets?this.components.widgets:[];if(!a.length)return!0;for(var b,c=a.length,d=0;d<c;d++)b=a[d],"function"==typeof b.validate&&b.validate();for(var e=0;e<c;e++)b=a[e],"function"==typeof b.save&&b.save();return!0},Charcoal.Admin.ComponentManager=g}(jQuery,document),function(a,b,c,d){"use strict";var e,f,g,h=[],i=function(){e=j.supported.slice(),f=a.extend({},j.definitions),g=a.extend({},j.aliases)},j={supported:["success","info","notice","warning","error"],definitions:{success:{title:"fr"===b.lang?"Succès!":"Success!",type:BootstrapDialog.TYPE_SUCCESS},notice:{title:("fr"===b.lang,"Notice!"),type:BootstrapDialog.TYPE_INFO,alias:["info"]},warning:{title:("fr"===b.lang,"Attention!"),type:BootstrapDialog.TYPE_WARNING},error:{title:"fr"===b.lang?"Une erreur s'est produite!":"An error occurred!",type:BootstrapDialog.TYPE_DANGER}},aliases:{info:"notice"}},k=function(){return this.reset(),arguments.length&&this.push.apply(this,arguments),this};k.prototype.validContext=function(b){return"string"===a.type(b)},k.prototype.parseContext=function(b){if("undefined"===a.type(b))b="global";else{var c=a.type(b);if("string"!==c)throw new TypeError("Storage key must be a string, received "+c)}if(b in this.storage)return b;throw new TypeError("Invalid key, received "+b)},k.prototype.resolveAliases=function(b){if(a.inArray(b,e)===-1)throw new TypeError('Unsupported feedback level, received "'+b+'". Must be one of: '+e.join(", "));var c=b;b=f[b];for(var d,h=b.alias.length-1;h>=0;h--)d=b.alias[h],g[d]=c;return this},k.prototype.push=function(){var b=arguments[0],c=arguments;this.validContext(b)?c=h.slice.call(arguments,1):b="global";for(var d,e=0;e<c.length;e++)d=c[e],"array"!==a.type(d)?("object"!==a.type(d)||d instanceof l||(d=l.createFromObject(d)),d instanceof l&&this.storage.push(d)):this.push.apply(this,[b].concat(d));return this},k.prototype.add_data=k.prototype.push,k.prototype.getMessages=function(){return this.storage},k.prototype.countMessages=function(){return this.storage.length},k.prototype.hasMessages=function(){return this.countMessages()>0},k.prototype.availableLevels=function(){return e},k.prototype.levels=function(){return f},k.prototype.level=function(a){return f[a]||null},k.prototype.setLevels=function(b){var c=a.type(b);if("object"!==c)throw new TypeError("Level(s) must be an associative array, received "+c);for(var d in b)a.inArray(d,e)||e.push(d),"aliases"in b[d]&&(b[d].alias=b[d].aliases,delete b[d].aliases),f[d]=a.extend({},j.definitions[d]||{},b[d]),b[d].alias&&this.resolveAliases(d);return this},k.prototype.mergeLevels=function(b){var c=a.type(b);if("object"!==c)throw new TypeError("Level(s) must be an associative array, received "+c);for(var d in b)a.inArray(d,e)||e.push(d),"aliases"in b[d]&&(b[d].alias=b[d].aliases,delete b[d].aliases),f[d]=a.extend({},j.definitions[d]||{},f[d]||{},b[d]),b[d].alias&&this.resolveAliases(d);return this},k.prototype.add_context=function(a){return a?"undefined"==typeof a.name||"undefined"==typeof a.title?this:(f[a.name]=a,this):this},k.prototype.add_context_alias=function(a,b){return a&&b&&f[b]?(g[a]=b,this):this},k.prototype.add_action=function(a){this.actions.push(a)},k.prototype.dispatch=function(){if(!this.hasMessages())return this;for(var a,b,c,d,e=this.getMessages(),f={},g=0;g<e.length;g++)b=e[g],a=b.level(),a in f||(f[a]=[]),f[a].push(b);for(a in f){if(c=this.level(a),d=[],this.actions.length)for(var h,i=0;i<this.actions.length;i++)h=this.actions[i],d.push({label:h.label,action:h.callback});BootstrapDialog.show({title:c.title,message:"<p>"+f[a].join("</p><p>")+"</p>",type:c.type,buttons:d})}return this.empty(),this},k.prototype.call=k.prototype.dispatch,k.prototype.empty=function(){i(),this.actions=[],this.storage=[]},k.prototype.reset=k.prototype.empty;var l=function(a,c){if(b.feedback(),!this.validLevel(a))throw new TypeError("Feedback level required. Must be one of: "+e.join(", "));return this.setLevel(a),this.validMessage(c)&&this.setMessage(c),this};l.createFromObject=function(a){var b=a.level||null,c=a.message||a.msg||null;return b||c?new l(b,c):null},l.prototype={toString:function(){return this.message()},level:function(){return this._level||null},setLevel:function(b){var c=a.type(b);if("string"!==c)throw new TypeError("Feedback level must be a string, received "+c);if(a.inArray(b,e)===-1)throw new TypeError('Unsupported feedback level, received "'+b+'". Must be one of: '+e.join(", "));return b in g&&(b=g[b]),this._level=b,this},validLevel:function(b){return"string"===a.type(b)&&a.inArray(b,e)>-1},message:function(){return this._message||null},setMessage:function(b){var c=a.type(b);if("string"!==c)throw new TypeError("Feedback message must be a string, received "+c);return this._message=b,this},validMessage:function(b){return"string"===a.type(b)}},i(),b.Feedback=k,b.FeedbackEntry=l}(jQuery,Charcoal.Admin,document),Charcoal.Admin.Widget=function(a){return this._element=void 0,this._id=void 0,this._type=void 0,this._opts=void 0,a?("string"==typeof a.id&&(this.set_element($("#"+a.id)),this.set_id(a.id)),"string"==typeof a.type&&(this.set_type(a.type),this.widget_type=a.type),this.set_opts(a),this):this},Charcoal.Admin.Widget.prototype.set_opts=function(a){return this._opts=a,this},Charcoal.Admin.Widget.prototype.opts=function(a){return"string"==typeof a?"undefined"!=typeof this._opts[a]&&this._opts[a]:this._opts},Charcoal.Admin.Widget.prototype.init=function(){return this},Charcoal.Admin.Widget.prototype.set_id=function(a){this._id=a},Charcoal.Admin.Widget.prototype.id=function(){return this._id},Charcoal.Admin.Widget.prototype.set_type=function(a){this._type=a},Charcoal.Admin.Widget.prototype.type=function(){return this._type},Charcoal.Admin.Widget.prototype.set_element=function(a){return this._element=a,this},Charcoal.Admin.Widget.prototype.widget_options=function(){return this.opts()},Charcoal.Admin.Widget.prototype.element=function(){return this._element},Charcoal.Admin.Widget.prototype.widget_options=function(){return this.opts()},Charcoal.Admin.Widget.prototype.widget_type=function(){return this.type()},Charcoal.Admin.Widget.prototype.save=function(){return!0},Charcoal.Admin.Widget.prototype.anim_out=function(a){return"function"!=typeof a&&(a=function(){}),this.element().fadeOut(400,a),this},Charcoal.Admin.Widget.prototype.reload=function(a){var b=this,c=Charcoal.Admin.admin_url()+"widget/load",d={widget_type:b.type(),widget_options:b.widget_options()};$.post(c,d,function(c){"string"==typeof c.widget_id&&(b.set_id(c.widget_id),b.anim_out(function(){b.element().replaceWith(c.widget_html),b.set_element($("#"+b.id())),b.element().hide().fadeIn(),b.init()})),"function"==typeof a&&a.call(b,c)},"json")},Charcoal.Admin.Widget.prototype.dialog=function(a,b){var c=a.title||"",d=a.type||BootstrapDialog.TYPE_DEFAULT,e=a.size||BootstrapDialog.SIZE_NORMAL,f=a.cssClass||"",g=a.showHeader||!0,h=a.showFooter||!0,i=a.dialog_options||{};delete a.title,delete a.type,delete a.size,delete a.cssClass,delete a.dialog_options;var j={title:c,type:d,size:e,cssClass:f,nl2br:!1,showHeader:g,showFooter:h,onshown:function(){Charcoal.Admin.manager().render()}},k=$.extend({},j,i);k.message=function(c){var d,e=Charcoal.Admin.admin_url()+"widget/load",f=a,i=$("<div>Loading...</div>");return g||c.getModalHeader().addClass("hidden"),h||c.getModalFooter().addClass("hidden"),c.getModalBody().on("click.charcoal.bs.dialog",'[data-dismiss="dialog"]',{dialog:c},function(a){a.data.dialog.close()}),d=$.ajax({method:"POST",url:e,data:f,dataType:"json"}),d.then(function(a,b,c){return a&&a.success?$.Deferred().resolve(a,b,c):a.feedbacks?$.Deferred().reject(c,b,a.feedbacks):$.Deferred().reject(c,b,"An unknown error occurred.")}).done(function(a){c.setMessage(a.widget_html),"function"==typeof b&&b(a),$('[data-toggle="tooltip"]',c.getModalBody()).tooltip()}).fail(function(a,b,d){c.setType(BootstrapDialog.TYPE_DANGER),c.setMessage('<div class="alert alert-danger" role="alert">An unknown error occurred.</div>');var e="";"string"===$.type(d)&&a.responseJSON&&a.responseJSON.feedbacks&&(d=a.responseJSON.feedbacks),$.isArray(d)?$.each(d,function(a,b){b.message&&("error"===b.level&&(b.level="danger"),e+='<div class="alert alert-'+b.level+'" role="alert">'+b.message+"</div>")}):"string"===$.type(d)&&(e='<div class="alert alert-danger" role="alert">'+d+"</div>"),e&&c.setMessage(e),$('[data-toggle="tooltip"]',c.getModalBody()).tooltip()}),i},BootstrapDialog.show(k)},Charcoal.Admin.Widget.prototype.confirm=function(a,b,c){var d={title:"Voulez-vous vraiment effectuer cette action?",confirm_label:"Oui",cancel_label:"Non"},e=$.extend(d,a);BootstrapDialog.show({title:e.title,buttons:[{label:e.cancel_label,action:function(a){"function"==typeof c&&c(),a.close()}},{label:e.confirm_label,action:function(a){"function"==typeof b&&b(),a.close()}}]})},Charcoal.Admin.Widget_Attachment=function(){return this.glyphs={embed:"glyphicon-blackboard",video:"glyphicon-film",image:"glyphicon-picture",file:"glyphicon-file",link:"glyphicon-link",text:"glyphicon-font",gallery:"glyphicon-duplicate",container:"glyphicon-list",accordion:"glyphicon-list"},this.dirty=!1,this},Charcoal.Admin.Widget_Attachment.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Attachment.prototype.constructor=Charcoal.Admin.Widget_Attachment,Charcoal.Admin.Widget_Attachment.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Attachment.prototype.init=function(){if("function"!=typeof $.fn.sortable){var a="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js";return Charcoal.Admin.loadScript(a,this.init.bind(this)),this}var b=this.element().find(".js-attachment-sortable .js-grid-container");return this.element().on("hidden.bs.collapse",'[data-toggle="collapse"]',function(){b.sortable("refreshPositions")}),b.sortable({handle:'[draggable="true"]',placeholder:"panel js-attachment-placeholder",start:function(a,b){var c=b.item.children(".panel-heading"),d=c.find('[data-toggle="collapse"]');d.hasClass("collapsed")||b.item.children(".panel-collapse").collapse("hide")}}).disableSelection(),this.listeners(),this},Charcoal.Admin.Widget_Attachment.prototype.is_dirty=function(){return this.dirty},Charcoal.Admin.Widget_Attachment.prototype.set_dirty_state=function(a){return this.dirty=a,this},Charcoal.Admin.Widget_Attachment.prototype.listeners=function(){var a=this,b=this.element().find(".js-attachment-sortable .js-grid-container");this.element().off("click").on("click.charcoal.attachments",".js-attachments-collapse",function(){var a=b.children(".js-attachment");b.hasClass("js-attachment-preview-only")&&a.children(".panel-heading.sr-only").removeClass("sr-only").addClass("sr-only-off"),a.children(".panel-collapse.in").collapse("hide")}).on("click.charcoal.attachments",".js-attachments-expand",function(){var a=b.children(".js-attachment");b.hasClass("js-attachment-preview-only")&&a.children(".panel-heading.sr-only-off").removeClass("sr-only-off").addClass("sr-only"),a.children(".panel-collapse:not(.in)").collapse("show")}).on("click.charcoal.attachments",".js-add-attachment",function(b){b.preventDefault();var c=$(this).data("type");if(!c)return!1;var d=$(this).data("id");if(d)a.add({id:d,type:c}),a.join(function(){a.reload()});else{var e=$(this).data("title")||"Edit";a.create_attachment(c,e,0,function(b){b.success&&(b.obj.id=b.obj_id,a.add(b.obj),a.join(function(){a.reload()}))})}}).on("click.charcoal.attachments",".js-attachment-actions a",function(b){var c=$(this);if(c.data("action")){b.preventDefault();var d=c.data("action");switch(d){case"edit":var e=c.data("type"),f=c.data("id");if(!e||!f)break;var g=c.data("title")||"Édition";a.create_attachment(e,g,f,function(b){b.success&&a.reload()});break;case"delete":if(!c.data("id"))break;a.confirm({title:"Voulez-vous vraiment supprimer cet item?"},function(){a.remove_join(c.data("id"),function(){a.reload()})});break;case"add-object":var h=c.data("type"),i=c.data("group"),j=c.data("id"),k=c.data("title"),l=c.data("attachment");a.create_attachment(l,k,0,function(b){b.success&&a.add_object_to_container({id:b.obj_id,type:b.obj.type},{id:j,type:h,group:i})})}}})},Charcoal.Admin.Widget_Attachment.prototype.select_attachment=function(a){if(!a.data("id")||!a.data("type"))return this},Charcoal.Admin.Widget_Attachment.prototype.create_attachment=function(a,b,c,d){c||(c=0);var e={title:b,size:BootstrapDialog.SIZE_WIDE,cssClass:"-quick-form",widget_type:"charcoal/admin/widget/quickForm",widget_options:{obj_type:a,obj_id:c}};this.dialog(e,function(b){if(b.success){if(!b.widget_id)return!1;Charcoal.Admin.manager().add_widget({id:b.widget_id,type:"charcoal/admin/widget/quick-form",data:{obj_type:a},obj_id:c,save_callback:function(a){d(a),BootstrapDialog.closeAll()}}),Charcoal.Admin.manager().render()}})},Charcoal.Admin.Widget_Attachment.prototype.add_object_to_container=function(a,b,c){var d=this,e={obj_type:b.type,obj_id:b.id,attachments:[{attachment_id:a.id,attachment_type:a.type,position:0}],group:c||b.group||""};$.post("add-join",e,function(){d.reload()},"json")},Charcoal.Admin.Widget_Attachment.prototype.add=function(a){if(!a)return!1;this.set_dirty_state(!0);var b=this.element().find(".js-attachment-template").clone();return b.find(".js-attachment").data("id",a.id).data("type",a.type),this.element().find(".js-attachment-sortable").find(".js-grid-container").append(b),this},Charcoal.Admin.Widget_Attachment.prototype.save=function(){return!this.is_dirty()&&void this.join()},Charcoal.Admin.Widget_Attachment.prototype.join=function(a){var b=this,c=b.opts(),d={obj_type:c.data.obj_type,obj_id:c.data.obj_id,attachments:[],group:c.data.group};this.element().find(".js-attachment-container").find(".js-attachment").each(function(a){var b=$(this),c=b.data("id"),e=b.data("type");d.attachments.push({attachment_id:c,attachment_type:e,position:a})}),$.post("join",d,function(){"function"==typeof a&&a(),b.set_dirty_state(!1)},"json")},Charcoal.Admin.Widget_Attachment.prototype.remove_join=function(a,b){if(!a)return!1;var c=this,d=c.opts(),e={obj_type:d.data.obj_type,obj_id:d.data.obj_id,attachment_id:a,group:d.data.group};$.post("remove-join",e,function(){"function"==typeof b&&b(),c.set_dirty_state(!1)},"json")},Charcoal.Admin.Widget_Attachment.prototype.widget_options=function(){return this.opts("widget_options")},Charcoal.Admin.Widget_Form=function(a){this.widget_type="charcoal/admin/widget/form",this.widget_id=null,this.obj_type=null,this.obj_id=null,this.form_selector=null,this.form_working=!1,this.suppress_feedback=!1,this.is_new_object=!1,this.xhr=null;var b=Charcoal.Admin.queryParams();"tab_ident"in b&&$('.js-group-tabs[data-tab-ident="'+b.tab_ident+'"]').tab("show"),Charcoal.Admin.set_lang($("[data-lang]:not(.hidden)").data("lang")),this.set_properties(a).bind_events()},Charcoal.Admin.Widget_Form.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Form.prototype.constructor=Charcoal.Admin.Widget_Form,Charcoal.Admin.Widget_Form.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Form.prototype.set_properties=function(a){return this.widget_id=a.id||this.widget_id,this.obj_type=a.data.obj_type||this.obj_type,this.obj_id=Charcoal.Admin.parseNumber(a.data.obj_id||this.obj_id),this.form_selector=a.data.form_selector||this.form_selector,this.isTab=a.data.tab,this},Charcoal.Admin.Widget_Form.prototype.bind_events=function(){var a=this;$(a.form_selector).on("submit",function(b){b.preventDefault(),a.submit_form(this)}),$(".js-obj-delete").on("click",function(b){b.preventDefault(),a.delete_object(this)}),$(".js-reset-form").on("click",function(b){b.preventDefault(),$(a.form_selector)[0].reset()}),$(".js-lang-switch button").on("click",function(b){b.preventDefault();var c=$(this),d=c.attr("data-lang-switch");a.switch_language(d)})},Charcoal.Admin.Widget_Form.prototype.submit_form=function(a){if(!this.form_working){this.form_working=!0,this.is_new_object=!this.obj_id;var b,c,d;if(c=$(a),b=c.find('[type="submit"]'),b.prop("disabled"))return!1;Charcoal.Admin.manager().prepare_submit(),d=new FormData(a),this.disable_form(c,b),this.xhr=$.ajax({type:"POST",url:this.request_url(),data:d,dataType:"json",processData:!1,contentType:!1}),this.xhr.then($.proxy(this.request_done,this,c,b)).done($.proxy(this.request_success,this,c,b)).fail($.proxy(this.request_failed,this,c,b)).always($.proxy(this.request_complete,this,c,b))}},Charcoal.Admin.Widget_Form.prototype.request_done=function(a,b,c,d,e){return c&&c.success?$.Deferred().resolve(c,d,e):c.feedbacks?$.Deferred().reject(e,d,c.feedbacks):$.Deferred().reject(e,d,"An unknown error occurred.")},Charcoal.Admin.Widget_Form.prototype.request_success=function(a,b,c){if(c.feedbacks&&Charcoal.Admin.feedback().add_data(c.feedbacks),c.next_url&&Charcoal.Admin.feedback().add_action({label:"Continuer",callback:function(){window.location.href=Charcoal.Admin.admin_url()+c.next_url}}),this.is_new_object)if(this.suppress_feedback=!0,c.next_url)window.location.href=Charcoal.Admin.admin_url()+c.next_url;else{var d=new URLSearchParams(window.location.search);window.location.href=Charcoal.Admin.admin_url()+"object/edit?"+(d.has("main_menu")?"main_menu="+d.get("main_menu")+"&":"")+(d.has("sidemenu")?"sidemenu="+d.get("sidemenu")+"&":"")+"obj_type="+this.obj_type+"&obj_id="+c.obj_id}},Charcoal.Admin.Widget_Form.prototype.request_failed=function(a,b,c,d,e){if(c.responseJSON&&c.responseJSON.feedbacks)Charcoal.Admin.feedback().add_data(c.responseJSON.feedbacks);else{var f=this.is_new_object?"The object could not be saved: ":"The object could not be updated: ",g=e||"Unknown Error";Charcoal.Admin.feedback().add_data([{level:f+g,msg:"error"}])}},Charcoal.Admin.Widget_Form.prototype.request_complete=function(a,b){this.suppress_feedback||(Charcoal.Admin.feedback().call(),this.enable_form(a,b)),this.form_working=this.is_new_object=this.suppress_feedback=!1},Charcoal.Admin.Widget_Form.prototype.disable_form=function(a,b){return a&&a.prop("disabled",!0),b&&b.prop("disabled",!0).children(".glyphicon").removeClass("hidden").next(".btn-label").addClass("sr-only"),this},Charcoal.Admin.Widget_Form.prototype.enable_form=function(a,b){return a&&a.prop("disabled",!1),b&&b.prop("disabled",!1).children(".glyphicon").addClass("hidden").next(".btn-label").removeClass("sr-only"),this},Charcoal.Admin.Widget_Form.prototype.request_url=function(){return this.is_new_object?Charcoal.Admin.admin_url()+"object/save":Charcoal.Admin.admin_url()+"object/update"},Charcoal.Admin.Widget_Form.prototype.delete_object=function(){var a=this,b=new URLSearchParams(window.location.search),c=Charcoal.Admin.admin_url()+"object/collection?"+(b.has("main_menu")?"main_menu="+b.get("main_menu")+"&":"")+(b.has("sidemenu")?"sidemenu="+b.get("sidemenu")+"&":"")+"obj_type="+this.obj_type;BootstrapDialog.confirm({title:"Confirmer la suppression",type:BootstrapDialog.TYPE_DANGER,message:"Êtes-vous sûr de vouloir supprimer cet objet? Cette action est irréversible.",btnOKLabel:"Supprimer",btnCancelLabel:"Annuler",callback:function(b){if(b){var d=Charcoal.Admin.admin_url()+"object/delete",e={obj_type:a.obj_type,obj_id:a.obj_id};$.ajax({method:"POST",url:d,data:e,dataType:"json"}).done(function(a){a.success?window.location.href=c:window.alert("Erreur. Impossible de supprimer cet objet.")})}}})},Charcoal.Admin.Widget_Form.prototype.switch_language=function(a){Charcoal.Admin.set_lang(a),$("[data-lang][data-lang!="+a+"]").addClass("hidden"),$("[data-lang][data-lang="+a+"]").removeClass("hidden"),$("[data-lang-switch][data-lang-switch!="+a+"]").removeClass("btn-info").addClass("btn-default"),$("[data-lang-switch][data-lang-switch="+a+"]").removeClass("btn-default").addClass("btn-info")},Charcoal.Admin.Widget_Map=function(){return this._controller=void 0,this.widget_type="charcoal/admin/widget/map",this},Charcoal.Admin.Widget_Map.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Map.prototype.constructor=Charcoal.Admin.Widget_Map,Charcoal.Admin.Widget_Map.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Map.prototype.init=function(){var a=this;return"undefined"==typeof google?(window._tmp_google_onload_function=function(){a.activate_map()},$.getScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&language=fr&callback=_tmp_google_onload_function",function(){})):a.activate_map(),this},Charcoal.Admin.Widget_Map.prototype.activate_map=function(){var a={strokeColor:"#000000",strokeOpacity:.8,strokeWeight:3,fillColor:"#ffffff",fillOpacity:.35,hover:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.5},focused:{fillOpacity:.8}},b={default_styles:a,use_clusterer:!1,map:{center:{x:this.opts("coords")[0],y:this.opts("coords")[1]},zoom:14,mapType:"roadmap",coordsType:"inpage",map_mode:"default"},places:{first:{type:"marker",coords:this.coords()}}};this._controller=new window.BB.gmap.controller(this.element().find(".js-map-maker-map").get(0),b),this.controller().set_styles([{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]}]),this.controller().remove_focus(),this.controller().init()},Charcoal.Admin.Widget_Map.prototype.controller=function(){return this._controller},Charcoal.Admin.Widget_Map.prototype.coords=function(){return this.opts("coords")},Charcoal.Admin.Widget_Pivot=function(){return this.dirty=!1,this},Charcoal.Admin.Widget_Pivot.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Pivot.prototype.constructor=Charcoal.Admin.Widget_Pivot,Charcoal.Admin.Widget_Pivot.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Pivot.prototype.init=function(){if("function"!=typeof $.fn.sortable){var a="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js";return Charcoal.Admin.loadScript(a,this.init.bind(this)),this}var b=this.element().find(".js-pivot-sortable .js-grid-container");return this.element().on("hidden.bs.collapse",'[data-toggle="collapse"]',function(){b.sortable("refreshPositions")}),b.sortable({handle:'[draggable="true"]',placeholder:"panel js-pivot-placeholder",start:function(a,b){var c=b.item.children(".panel-heading"),d=c.find('[data-toggle="collapse"]');d.hasClass("collapsed")||b.item.children(".panel-collapse").collapse("hide")}}).disableSelection(),this.listeners(),this},Charcoal.Admin.Widget_Pivot.prototype.is_dirty=function(){return this.dirty},Charcoal.Admin.Widget_Pivot.prototype.set_dirty_state=function(a){return this.dirty=a,this},Charcoal.Admin.Widget_Pivot.prototype.listeners=function(){var a=this;this.element().off("click").on("click.charcoal.pivots",".js-add-pivot",function(b){b.preventDefault();var c=$(this).data("type");if(!c)return!1;var d=$(this).data("title")||"Edit";a.create_pivot_dialog(c,d,0,function(b){b.success&&(b.obj.id=b.obj_id,a.add(b.obj),a.create_pivot(function(){a.reload()}))})}).on("click.charcoal.pivots",".js-pivot-actions a",function(b){var c=$(this);if(c.data("action")){b.preventDefault();var d=c.data("action");switch(d){case"delete":if(!c.data("id"))break;a.confirm({title:"Are you certain that you want to remove this item?"},function(){a.remove_pivot(c.data("id"),function(){a.reload()})})}}})},Charcoal.Admin.Widget_Pivot.prototype.create_pivot_dialog=function(a,b,c,d){c||(c=0);var e={title:b,size:BootstrapDialog.SIZE_WIDE,cssClass:"-quick-form",widget_type:"charcoal/admin/widget/quickForm",widget_options:{obj_type:a,obj_id:c}};this.dialog(e,function(b){if(b.success){if(!b.widget_id)return!1;Charcoal.Admin.manager().add_widget({id:b.widget_id,type:"charcoal/admin/widget/quick-form",data:{obj_type:a},obj_id:c,save_callback:function(a){d(a),BootstrapDialog.closeAll()}}),Charcoal.Admin.manager().render()}})},Charcoal.Admin.Widget_Pivot.prototype.add=function(a){if(!a)return!1;this.set_dirty_state(!0);var b=this.element().find(".js-pivot-template").clone();return b.find(".js-pivot").data("id",a.id).data("type",a.type),this.element().find(".js-pivot-sortable").find(".js-grid-container").append(b),this},Charcoal.Admin.Widget_Pivot.prototype.save=function(){return!this.is_dirty()&&void this.create_pivot()},Charcoal.Admin.Widget_Pivot.prototype.create_pivot=function(a){var b=this,c=b.opts(),d={obj_type:c.data.obj_type,obj_id:c.data.obj_id,target_object_type:c.data.target_object_type,pivots:[]};this.element().find(".js-pivot-container").find(".js-pivot").each(function(a){var b=$(this),c=b.data("id");d.pivots.push({target_object_id:c,position:a})}),$.post("pivot/create",d,function(){"function"==typeof a&&a(),b.set_dirty_state(!1)},"json")},Charcoal.Admin.Widget_Pivot.prototype.remove_pivot=function(a,b){if(!a)return!1;var c=this,d={pivot_id:a};$.post("pivot/remove",d,function(){"function"==typeof b&&b(),c.set_dirty_state(!1)},"json")},Charcoal.Admin.Widget_Pivot.prototype.widget_options=function(){return this.opts("widget_options")},Charcoal.Admin.Widget_Quick_Form=function(a){return this.widget_type="charcoal/admin/widget/quick-form",this.save_callback=a.save_callback||"",this.cancel_callback=a.cancel_callback||"",this.form_working=!1,this.suppress_feedback=!1,this.is_new_object=!1,this.xhr=null,this.obj_id=Charcoal.Admin.parseNumber(a.obj_id)||0,this},Charcoal.Admin.Widget_Quick_Form.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Quick_Form.prototype.constructor=Charcoal.Admin.Widget_Quick_Form,Charcoal.Admin.Widget_Quick_Form.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Quick_Form.prototype.init=function(){this.bind_events()},Charcoal.Admin.Widget_Quick_Form.prototype.bind_events=function(){var a=this;$(document).on("submit","#"+this.id(),function(b){b.preventDefault(),a.submit_form(this)}),$("#"+this.id()).on("click.charcoal.bs.dialog",'[data-dismiss="dialog"]',function(b){$.isFunction(a.cancel_callback)&&a.cancel_callback(b)})},Charcoal.Admin.Widget_Quick_Form.prototype.submit_form=function(a){if(!this.form_working){this.form_working=!0,this.is_new_object=!this.obj_id;var b,c,d;if(c=$(a),b=c.find('[type="submit"]'),b.prop("disabled"))return!1;Charcoal.Admin.manager().prepare_submit(),d=new FormData(a),this.disable_form(c,b),this.xhr=$.ajax({type:"POST",url:this.request_url(),data:d,dataType:"json",processData:!1,contentType:!1}),this.xhr.then($.proxy(this.request_done,this,c,b)).done($.proxy(this.request_success,this,c,b)).fail($.proxy(this.request_failed,this,c,b)).always($.proxy(this.request_complete,this,c,b))}},Charcoal.Admin.Widget_Quick_Form.prototype.disable_form=Charcoal.Admin.Widget_Form.prototype.disable_form,Charcoal.Admin.Widget_Quick_Form.prototype.enable_form=Charcoal.Admin.Widget_Form.prototype.enable_form,Charcoal.Admin.Widget_Quick_Form.prototype.request_url=Charcoal.Admin.Widget_Form.prototype.request_url,Charcoal.Admin.Widget_Quick_Form.prototype.request_done=Charcoal.Admin.Widget_Form.prototype.request_done,
Charcoal.Admin.Widget_Quick_Form.prototype.request_failed=Charcoal.Admin.Widget_Form.prototype.request_failed,Charcoal.Admin.Widget_Quick_Form.prototype.request_complete=Charcoal.Admin.Widget_Form.prototype.request_complete,Charcoal.Admin.Widget_Quick_Form.prototype.request_success=function(a,b,c){c.feedbacks&&Charcoal.Admin.feedback().add_data(c.feedbacks),c.next_url&&Charcoal.Admin.feedback().add_action({label:"Continuer",callback:function(){window.location.href=Charcoal.Admin.admin_url()+c.next_url}}),"function"==typeof this.save_callback&&this.save_callback(c)},Charcoal.Admin.Widget_Search=function(a){return this._elem=void 0,!!a&&("undefined"!=typeof a.id&&(this.set_element($("#"+a.id)),"object"==typeof a.data&&(this.opts=a,this)))},Charcoal.Admin.Widget_Search.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Search.prototype.constructor=Charcoal.Admin.Widget_Search,Charcoal.Admin.Widget_Search.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Search.prototype.set_remote_widget=function(){},Charcoal.Admin.Widget_Search.prototype.init=function(){var a=this.element(),b=this;a.on("click",".js-search",function(a){a.preventDefault(),b.submit()}),a.on("click",".js-undo",function(a){a.preventDefault(),b.undo()})},Charcoal.Admin.Widget_Search.prototype.submit=function(){for(var a=Charcoal.Admin.manager(),b=a.components.widgets,c=0,d=b.length;c<d;c++)this.dispatch(b[c]);return this},Charcoal.Admin.Widget_Search.prototype.undo=function(){return this.element().find("input").val(""),this.submit(),this},Charcoal.Admin.Widget_Search.prototype.dispatch=function(a){if(!a)return this;if("function"!=typeof a.add_filter)return this;"undefined"!=typeof a.pagination&&(a.pagination.page=1);for(var b=this.element().find("input"),c=b.val(),d=this.opts.data.list||[],e=0,f=d.length;e<f;e++){var g={};g[d[e]]={},g[d[e]].val="%"+c+"%",g[d[e]].property=d[e],g[d[e]].operator="LIKE",g[d[e]].operand="OR",a.add_filter(g)}return a.reload(),this},Charcoal.Admin.Widget_Table=function(){this.obj_type=null,this.widget_id=null,this.table_selector=null,this.table_rows=[],this.filters=[],this.orders=[],this.pagination={page:1,num_per_page:50},this.template=this.properties=this.properties_options=void 0},Charcoal.Admin.Widget_Table.prototype=Object.create(Charcoal.Admin.Widget.prototype),Charcoal.Admin.Widget_Table.prototype.constructor=Charcoal.Admin.Widget_Table,Charcoal.Admin.Widget_Table.prototype.parent=Charcoal.Admin.Widget.prototype,Charcoal.Admin.Widget_Table.prototype.init=function(){this.set_properties().create_rows().bind_events()},Charcoal.Admin.Widget_Table.prototype.set_properties=function(){var a=this.opts();return this.obj_type=a.data.obj_type||this.obj_type,this.widget_id=a.id||this.widget_id,this.table_selector="#"+this.widget_id,this.template=a.data.template||this.template,this.properties=a.data.properties||this.properties,this.properties_options=a.data.properties_options||this.properties_options,this.filters=a.data.filters||this.filters,this.orders=a.data.orders||this.orders,this.pagination=a.data.pagination||this.pagination,this.collection_ident=a.data.collection_ident||"default",this},Charcoal.Admin.Widget_Table.prototype.create_rows=function(){for(var a=$(".js-table-row"),b=0,c=a.length;b<c;b++){var d=a[b],e=new Charcoal.Admin.Widget_Table.Table_Row(this,d);this.table_rows.push(e)}return this},Charcoal.Admin.Widget_Table.prototype.bind_events=function(){var a=this;$(".js-list-quick-create",a.table_selector).on("click",function(b){b.preventDefault();var c=Charcoal.Admin.admin_url()+"widget/load",d={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:a.obj_type,obj_id:0}};$.post(c,d,function(a){var b=BootstrapDialog.show({title:"Quick Create",message:"…",nl2br:!1});b.getModalBody().on("click.charcoal.bs.dialog",'[data-dismiss="dialog"]',{dialog:b},function(a){a.data.dialog.close()}),a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))},"json")}),$(".js-sublist-inline-edit").on("click",function(b){b.preventDefault();var c=a.sublist(),d=Charcoal.Admin.admin_url()+"widget/table/inlinemulti",e={obj_type:a.obj_type,obj_ids:c.obj_ids};$.post(d,e,function(a){if(a.success)for(var b=a.objects,d=0;d<=b.length-1;d++){window.console.debug(b[d]);var e=b[d].inline_properties,f=$(c.elems[d]).parents("tr"),g=0;for(g in e){var h=f.find(".property-"+g);h.html(e[g])}}},"json")}),$(".js-list-import",a.element).on("click",function(b){b.preventDefault();var c=$(this),d=c.data("widget-type");console.debug(d),a.widget_dialog({title:"Importer une liste",widget_type:d,widget_options:{obj_type:a.obj_type,obj_id:0}})}),$("tbody.js-sortable").sortable({cursor:"ns-resize",delay:150,distance:5,opacity:.75,containment:"parent",placeholder:"ui-tablesort-placeholder",helper:function(a,b){return b.children().each(function(){$(this).width($(this).width())}),b},change:function(a,b){console.debug(a,b)},update:function(b,c){console.debug(b,c);var d=$(this).sortable("toArray",{attribute:"data-id"}),e={obj_type:a.obj_type,obj_orders:d,starting_order:1},f=Charcoal.Admin.admin_url()+"object/reorder";$.ajax({method:"POST",url:f,data:e,dataType:"json"}).done(function(a){console.debug(a)})}}).disableSelection(),$(".js-page-switch").on("click",function(b){b.preventDefault();var c=$(this),d=c.data("page-num");a.pagination.page=d,a.reload()})},Charcoal.Admin.Widget_Table.prototype.sublist=function(){var a=$(".select-row:checked"),b={elems:[],obj_ids:[]};return a.each(function(a,c){b.obj_ids.push($(c).parents("tr").data("id")),b.elems.push(c)}),b},Charcoal.Admin.Widget_Table.prototype.add_filter=function(a){var b=this.get_filters();return null===b&&(b={}),b=$.extend(b,a),this.set_filters(b),this},Charcoal.Admin.Widget_Table.prototype.set_filters=function(a){this.filters=a},Charcoal.Admin.Widget_Table.prototype.get_filters=function(){return this.filters},Charcoal.Admin.Widget_Table.prototype.widget_options=function(){return{obj_type:this.obj_type,template:this.template,collection_ident:this.collection_ident,collection_config:{properties:this.properties,properties_options:this.properties_options,filters:this.filters,orders:this.orders,pagination:this.pagination}}},Charcoal.Admin.Widget_Table.prototype.reload=function(a){return Charcoal.Admin.Widget.prototype.reload.call(this,a),this},Charcoal.Admin.Widget_Table.prototype.widget_dialog=function(a){var b=a.title||"",c=a.type||BootstrapDialog.TYPE_PRIMARY,d=a.size||BootstrapDialog.SIZE_NORMAL,e=a.widget_type,f=a.widget_options||{};e&&BootstrapDialog.show({title:b,type:c,size:d,nl2br:!1,message:function(a){var b=Charcoal.Admin.admin_url()+"widget/load",c={widget_type:e,widget_options:f},d=$("<div>Loading…</div>");return a.getModalBody().on("click.charcoal.bs.dialog",'[data-dismiss="dialog"]',{dialog:a},function(a){a.data.dialog.close()}),$.ajax({method:"POST",url:b,data:c,dataType:"json"}).done(function(b){console.debug(b),b.success?a.setMessage(b.widget_html):(a.setType(BootstrapDialog.TYPE_DANGER),a.setMessage("Error"))}),d}})},Charcoal.Admin.Widget_Table.Table_Row=function(a,b){this.widget_table=a,this.element=b,this.obj_id=this.element.getAttribute("data-id"),this.obj_type=this.widget_table.obj_type,this.load_url=Charcoal.Admin.admin_url()+"widget/load",this.inline_url=Charcoal.Admin.admin_url()+"widget/table/inline",this.delete_url=Charcoal.Admin.admin_url()+"object/delete",this.bind_events()},Charcoal.Admin.Widget_Table.Table_Row.prototype.bind_events=function(){var a=this;$(".js-obj-quick-edit",a.element).on("click",function(b){b.preventDefault(),a.quick_edit()}),$(".js-obj-inline-edit",a.element).on("click",function(b){b.preventDefault(),a.inline_edit()}),$(".js-obj-delete",a.element).on("click",function(b){b.preventDefault(),a.delete_object()})},Charcoal.Admin.Widget_Table.Table_Row.prototype.quick_edit=function(){var a={widget_type:"charcoal/admin/widget/objectForm",widget_options:{obj_type:this.obj_type,obj_id:this.obj_id}};$.post(this.load_url,a,function(a){var b=BootstrapDialog.show({title:"Quick Edit",message:"…",nl2br:!1});b.getModalBody().on("click.charcoal.bs.dialog",'[data-dismiss="dialog"]',{dialog:b},function(a){a.data.dialog.close()}),a.success?b.setMessage(a.widget_html):(b.setType(BootstrapDialog.TYPE_DANGER),b.setMessage("Error"))},"json")},Charcoal.Admin.Widget_Table.Table_Row.prototype.inline_edit=function(){var a=this,b={obj_type:a.obj_type,obj_id:a.obj_id};$.post(a.inline_url,b,function(b){if(b.success){var c,d=b.inline_properties;for(c in d){var e=$(a.element).find(".property-"+c);e.html(d[c])}}},"json")},Charcoal.Admin.Widget_Table.Table_Row.prototype.delete_object=function(){var a=this;BootstrapDialog.confirm({title:"Confirmer la suppression",type:BootstrapDialog.TYPE_DANGER,message:"Êtes-vous sûr de vouloir supprimer cet objet? Cette action est irréversible.",btnOKLabel:"Supprimer",btnCancelLabel:"Annuler",callback:function(b){if(b){var c=a.delete_url,d={obj_type:a.obj_type,obj_id:a.obj_id};$.ajax({method:"POST",url:c,data:d,dataType:"json"}).done(function(b){b.success?$(a.element).remove():window.alert("Erreur. Impossible de supprimer cet objet.")})}}})},Charcoal.Admin.Widget_Wysiwyg=function(){$(".js-wysiwyg").summernote({height:300})},Charcoal.Admin.Property=function(a){return this._ident=void 0,this._val=void 0,this._type=void 0,this._input_type=void 0,"string"==typeof a.ident&&this.set_ident(a.ident),"undefined"!=typeof a.val&&this.set_val(a.val),"undefined"!=typeof a.type&&this.set_type(a.type),"undefined"!=typeof a.input_type&&this.set_input_type(a.input_type),this.data=a,this},Charcoal.Admin.Property.prototype.set_ident=function(a){this._ident=a},Charcoal.Admin.Property.prototype.set_val=function(a){this._val=a},Charcoal.Admin.Property.prototype.set_type=function(a){this._type=a},Charcoal.Admin.Property.prototype.set_input_type=function(a){this._input_type=a},Charcoal.Admin.Property.prototype.ident=function(){return this._ident},Charcoal.Admin.Property.prototype.val=function(){return this._val},Charcoal.Admin.Property.prototype.type=function(){return this._type},Charcoal.Admin.Property.prototype.input_type=function(){return this._input_type},Charcoal.Admin.Property.prototype.element=function(){if(!this._element){if(!this.data.id)return!1;this._element=$("#"+this.data.id)}return this._element},Charcoal.Admin.Property.prototype.validate=function(){},Charcoal.Admin.Property.prototype.save=function(){return this},Charcoal.Admin.Property.prototype.error=function(a){window.console.error(a)},Charcoal.Admin.Property_Input_Audio=function(a){a.input_type="charcoal/admin/property/input/audio",Charcoal.Admin.Property.call(this,a),this.text_properties={},this.recording_properties={},this.file_properties={},this.initialized_types=[],this.active_pane=a.data.active_pane||"text",this._recorder=void 0,this.init()},Charcoal.Admin.Property_Input_Audio.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Audio.prototype.constructor=Charcoal.Admin.Property_Input_Audio,Charcoal.Admin.Property_Input_Audio.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Audio.prototype.init=function(){var a=this.data;"undefined"==typeof a.id&&console.error("Missing ID"),this.text_properties.$voice_message=$(".js-text-voice-message",this.element()),this.recording_properties.audio_context=null,this.recording_properties.audio_recorder=null,this.recording_properties.animation_frame=null,this.recording_properties.analyser_context=null,this.recording_properties.canvas_width=0,this.recording_properties.canvas_height=0,this.recording_properties.recording_index=0,this.recording_properties.current_recording=null,this.recording_properties.audio_player=null,this.recording_properties.hidden_input_id=a.data.hidden_input_id,this.recording_properties.$analyser_canvas=$(".js-recording-analyser",this.element()),this.recording_properties.$waves_canvas=$(".js-recording-waves",this.element()),this.recording_properties.record_button_class="js-recording-record",this.recording_properties.$record_button=$(".js-recording-record",this.element()),this.recording_properties.stop_button_class="js-recording-stop",this.recording_properties.$stop_button=$(".js-recording-stop",this.element()),this.recording_properties.playback_button_class="js-recording-playback",this.recording_properties.$playback_button=$(".js-recording-playback",this.element()),this.recording_properties.reset_button_class="js-recording-reset",this.recording_properties.$reset_button=$(".js-recording-reset",this.element()),this.recording_properties.$timer=$(".js-recording-timer",this.element()),this.file_properties.$file_audio=$(".js-file-audio",this.element()),this.file_properties.$file_reset=$(".js-file-reset",this.element()),this.file_properties.$file_input=$(".js-file-input",this.element()),this.file_properties.$file_input_hiden=$(".js-file-input-hidden",this.element()),this.file_properties.reset_button_class="js-file-reset",this.set_nav(this.active_pane).bind_nav_controls()},Charcoal.Admin.Property_Input_Audio.prototype.bind_nav_controls=function(){var a=this;this.element().on("click",".js-toggle-pane",function(){var b=$(this);a.set_nav(b.attr("data-pane"))})},Charcoal.Admin.Property_Input_Audio.prototype.set_nav=function(a){if(a){var b=$(".js-toggle-pane"),c=$(".js-pane"),d=c.filter('[data-pane="'+a+'"]');if(!d.hasClass("-active")){var e=b.filter('[data-pane="'+a+'"]');b.removeClass("-active"),e.addClass("-active"),c.removeClass("-active"),c.addClass("hidden"),d.removeClass("hidden"),d.addClass("-active"),this.prepare_pane(a)}}return this},Charcoal.Admin.Property_Input_Audio.prototype.prepare_pane=function(a){var b="init_"+a,c=Charcoal.Admin.Property_Input_Audio.prototype[b];"function"==typeof c&&this[b]()},Charcoal.Admin.Property_Input_Audio.prototype.init_text=function(){if(this.initialized_types.indexOf("text")===-1){this.initialized_types.push("text");var a=this.text_properties.$voice_message.val();a=this.text_strip_tags(a),this.text_properties.$voice_message.val(a)}},Charcoal.Admin.Property_Input_Audio.prototype.text_strip_tags=function(a,b){b=((String(b)||"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var c=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,d=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return a.replace(d,"").replace(c,function(a,c){return b.indexOf("<"+c.toLowerCase()+">")>-1?a:""})},Charcoal.Admin.Property_Input_Audio.prototype.init_file=function(){this.initialized_types.indexOf("file")===-1&&(this.initialized_types.push("file"),this.file_bind_events())},Charcoal.Admin.Property_Input_Audio.prototype.file_bind_events=function(){var a=this;a.element().on("click","."+a.file_properties.reset_button_class,function(){a.file_reset_input()})},Charcoal.Admin.Property_Input_Audio.prototype.file_reset_input=function(){this.file_properties.$file_audio.attr("src","").addClass("hide"),this.file_properties.$file_reset.addClass("hide"),this.file_properties.$file_input.removeClass("hide").wrap("<form>").closest("form").get(0).reset(),this.file_properties.$file_input.unwrap(),this.file_properties.$file_input_hiden.val("")},Charcoal.Admin.Property_Input_Audio.prototype.init_recording=function(){if(this.initialized_types.indexOf("recording")===-1){var a=this;a.initialized_types.push("recording"),window.navigator.getUserMedia||(window.navigator.getUserMedia=window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia),window.navigator.cancelAnimationFrame||(window.navigator.cancelAnimationFrame=window.navigator.webkitCancelAnimationFrame||window.navigator.mozCancelAnimationFrame),window.navigator.requestAnimationFrame||(window.navigator.requestAnimationFrame=window.navigator.webkitRequestAnimationFrame||window.navigator.mozRequestAnimationFrame),window.AudioContext||(window.AudioContext=window.AudioContext||window.webkitAudioContext),window.navigator.getUserMedia({audio:{mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1},optional:[]}},function(b){a.recording_bind_events(),a.recording_got_stream(b)},function(a){window.alert("Error getting audio. Try plugging in a microphone"),window.console.log(a)})}},Charcoal.Admin.Property_Input_Audio.prototype.recording_bind_events=function(){var a=this;a.element().on("click","."+a.recording_properties.record_button_class,function(){a.recording_manage_recorder()}),a.element().on("click","."+a.recording_properties.stop_button_class,function(){a.recording_manage_recorder("stop")}),a.element().on("click","."+a.recording_properties.playback_button_class,function(){0!==a.recording_properties.recording_index&&null!==a.recording_properties.audio_player&&a.recording_toggle_playback()}),a.element().on("click","."+a.recording_properties.reset_button_class,function(){a.recording_reset_audio()})},Charcoal.Admin.Property_Input_Audio.prototype.recording_got_stream=function(a){var b=this;b.recording_properties.audio_context=new window.AudioContext,b.recording_properties.audio_player=new window.Audio_Player({on_ended:function(){b.recording_manage_button_states("pause_playback")},on_timeupdate:function(a){b.recording_render_timer(a)},on_loadedmetadata:function(a){b.recording_render_timer(a)}});var c=b.recording_properties.audio_context.createGain(),d=b.recording_properties.audio_context.createMediaStreamSource(a),e=null;d.connect(c),window.analyserNode=b.recording_properties.audio_context.createAnalyser(),window.analyserNode.fftSize=2048,c.connect(window.analyserNode),b.recording_properties.audio_recorder=new window.Recorder(c),e=b.recording_properties.audio_context.createGain(),e.gain.value=0,c.connect(e),e.connect(b.recording_properties.audio_context.destination),b.recording_update_analysers()},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_button_states=function(a){switch(a){case"start_recording":this.recording_properties.$record_button.addClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!1),this.recording_properties.$playback_button.prop("disabled",!0),this.recording_properties.$reset_button.prop("disabled",!1);break;case"pause_recording":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!1),this.recording_properties.$playback_button.prop("disabled",!0),this.recording_properties.$reset_button.prop("disabled",!1);break;case"stop_recording":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!0),this.recording_properties.$playback_button.prop("disabled",!1),this.recording_properties.$reset_button.prop("disabled",!1);break;case"start_playback":this.recording_properties.$playback_button.addClass("is-playing");break;case"pause_playback":this.recording_properties.$playback_button.removeClass("is-playing");break;case"reset":this.recording_properties.$record_button.removeClass("is-recording"),this.recording_properties.$stop_button.prop("disabled",!0),this.recording_properties.$playback_button.prop("disabled",!0).removeClass("is-playing"),this.recording_properties.$reset_button.prop("disabled",!0)}},Charcoal.Admin.Property_Input_Audio.prototype.recording_render_timer=function(a){var b="";if(a){var c=0,d=0,e=a.duration-a.currentTime;c=Math.floor(e/60),d=Math.round(e)%60,b+=(c<10?"0":"")+String(c)+":",b+=(d<10?"0":"")+String(d)}else b="00:00";this.recording_properties.$timer.text(b)},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_recorder=function(a){var b=this;if("stop"===a)return b.recording_properties.audio_recorder.stop(),b.recording_properties.audio_recorder.get_buffers(function(a){b.recording_got_buffers(a),b.recording_properties.audio_recorder.clear(),b.recording_display_canvas("waves")}),void b.recording_manage_button_states("stop_recording");if(b.recording_properties.audio_recorder.is_recording())b.recording_properties.audio_recorder.stop(),b.recording_manage_button_states("pause_recording");else{if(!b.recording_properties.audio_recorder)return;b.recording_properties.audio_recorder.record(),b.recording_manage_button_states("start_recording"),b.recording_display_canvas("analyser")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_toggle_playback=function(){if(this.recording_properties.audio_player.is_playing())this.recording_properties.audio_player.pause(),this.recording_manage_button_states("pause_playback");else{if(!this.recording_properties.audio_player)return;this.recording_properties.audio_player.play(),this.recording_manage_button_states("start_playback")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_reset_audio=function(){var a=this.recording_properties.$analyser_canvas[0],b=a.getContext("2d");b.clearRect(0,0,a.canvas_width,a.canvas_height);var c=this.recording_properties.$waves_canvas[0],d=c.getContext("2d");d.clearRect(0,0,c.canvas_width,c.canvas_height),this.recording_properties.audio_player.load(),this.recording_properties.audio_player.src(""),this.recording_properties.audio_recorder.stop(),this.recording_properties.audio_recorder.clear(),this.recording_manage_button_states("reset"),this.recording_display_canvas("analyser"),this.recording_render_timer();var e=document.getElementById(this.recording_properties.hidden_input_id);e&&(e.value="")},Charcoal.Admin.Property_Input_Audio.prototype.recording_got_buffers=function(a){var b=this.recording_properties.$waves_canvas[0],c=this;c.recording_draw_buffer(b.width,b.height,b.getContext("2d"),a[0]),c.recording_properties.audio_recorder.export_wav(function(a){c.recording_done_encoding(a)})},Charcoal.Admin.Property_Input_Audio.prototype.recording_draw_buffer=function(a,b,c,d){var e=Math.ceil(d.length/a),f=b/2;c.fillStyle="#DDDDDD",c.clearRect(0,0,a,b);for(var g=0;g<a;g++){for(var h=1,i=-1,j=0;j<e;j++){var k=d[g*e+j];k<h&&(h=k),k>i&&(i=k)}c.fillRect(g,(1+h)*f,1,Math.max(1,(i-h)*f))}},Charcoal.Admin.Property_Input_Audio.prototype.recording_done_encoding=function(a){var b=new window.FileReader,c=null,d=this;b.readAsDataURL(a),b.onloadend=function(){c=b.result,d.recording_properties.recording_index++,d.recording_manage_audio_data(c)}},Charcoal.Admin.Property_Input_Audio.prototype.recording_manage_audio_data=function(a){if(a){var b=document.getElementById(this.recording_properties.hidden_input_id);b&&(b.value=a),this.recording_properties.audio_player.src(a),this.recording_properties.audio_player.load()}},Charcoal.Admin.Property_Input_Audio.prototype.recording_display_canvas=function(a){switch(a){case"waves":this.recording_properties.$analyser_canvas.addClass("hidden"),this.recording_properties.$waves_canvas.removeClass("hidden");break;default:this.recording_properties.$analyser_canvas.removeClass("hidden"),this.recording_properties.$waves_canvas.addClass("hidden")}},Charcoal.Admin.Property_Input_Audio.prototype.recording_cancel_analyser_update=function(){window.cancelAnimationFrame(this.recording_properties.animation_frame),this.recording_properties.animation_frame=null},Charcoal.Admin.Property_Input_Audio.prototype.recording_update_analysers=function(){this.recording_properties.analyser_context||(this.recording_properties.analyser_context=this.recording_properties.$analyser_canvas[0].getContext("2d"));var a=this,b=a.recording_properties.analyser_context,c=a.recording_properties.$analyser_canvas[0];if(a.recording_properties.canvas_width=c.width,a.recording_properties.canvas_height=c.height,b.lineCap="round",a.recording_properties.audio_recorder.is_recording()){var d=5,e=2,f=Math.round(a.recording_properties.canvas_width/d),g=new window.Uint8Array(window.analyserNode.frequencyBinCount),h=0;window.analyserNode.getByteFrequencyData(g),h=window.analyserNode.frequencyBinCount/f,b.clearRect(0,0,a.recording_properties.canvas_width,a.recording_properties.canvas_height);for(var i=0;i<f;++i){for(var j=0,k=Math.floor(i*h),l=0;l<h;l++)j+=g[k+l];j/=h,b.fillStyle=b.fillStyle="#DDDDDD",b.fillRect(i*d,a.recording_properties.canvas_height,e,-j)}}else b.clearRect(0,0,a.recording_properties.canvas_width,a.recording_properties.canvas_height);a.recording_properties.animation_frame=window.requestAnimationFrame(function(){a.recording_update_analysers()})},function(a){var b="../../assets/admin/scripts/vendors/recorderWorker.js",c=function(c,d){var e,f=d||{},g=f.buffer_length||4096,h=new a.Worker(f.workerPath||b),i=!1;this.context=c.context,this.context.createScriptProcessor?this.node=this.context.createScriptProcessor(g,2,2):this.node=this.context.createJavaScriptNode(g,2,2),h.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}}),this.node.onaudioprocess=function(a){i&&h.postMessage({command:"record",buffer:[a.inputBuffer.getChannelData(0),a.inputBuffer.getChannelData(1)]})},this.configure=function(a){for(var b in a)a.hasOwnProperty(b)&&(f[b]=a[b])},this.record=function(){i=!0},this.stop=function(){i=!1},this.clear=function(){h.postMessage({command:"clear"})},this.get_buffers=function(a){e=a||f.callback,h.postMessage({command:"getBuffers"})},this.export_wav=function(a,b){if(e=a||f.callback,b=b||f.type||"audio/wav",!e)throw new Error("Callback not set");h.postMessage({command:"exportWAV",type:b})},this.is_recording=function(){return i},h.onmessage=function(a){var b=a.data;e(b)},c.connect(this.node),this.node.connect(this.context.destination)};a.Recorder=c}(window),function(a){var b=function(b){this.callbacks={on_ended:b.on_ended||function(){},on_pause:b.on_pause||function(){},on_playing:b.on_playing||function(){},on_timeupdate:b.on_timeupdate||function(){},on_loadedmetadata:b.on_loadedmetadata||function(){}},this._element=new a.Audio,this.play=function(){this.element().play()},this.pause=function(){this.element().pause()},this.load=function(){this.element().load()},this.src=function(a){this.element().src=a},this.is_playing=function(){return!this.element().paused&&!this.element().ended&&this.element().currentTime>0},this.element=function(){return this._element};var c=this;c.element().addEventListener("ended",function(){c.callbacks.on_ended()}),c.element().addEventListener("pause",function(){c.callbacks.on_pause()}),c.element().addEventListener("playing",function(){c.callbacks.on_playing()}),c.element().addEventListener("timeupdate",function(){c.callbacks.on_timeupdate(c.element())}),c.element().addEventListener("loadedmetadata",function(){c.callbacks.on_loadedmetadata(c.element())})};a.Audio_Player=b}(window),Charcoal.Admin.Property_Input_ColorPicker=function(a){this.input_type="charcoal/admin/property/input/colorpicker",this.input_id=null,this.colorpicker_selector=null,this.colorpicker_options=null,this.set_properties(a).create_colorpicker()},Charcoal.Admin.Property_Input_ColorPicker.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_ColorPicker.prototype.constructor=Charcoal.Admin.Property_Input_ColorPicker,Charcoal.Admin.Property_Input_ColorPicker.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_ColorPicker.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.colorpicker_selector=a.data.colorpicker_selector||this.colorpicker_selector,this.colorpicker_options=a.data.colorpicker_options||this.colorpicker_options;var b={};return this.colorpicker_options=$.extend({},b,this.colorpicker_options),this},Charcoal.Admin.Property_Input_ColorPicker.prototype.create_colorpicker=function(){return $(this.colorpicker_selector).minicolors(this.colorpicker_options),this},Charcoal.Admin.Property_Input_DateTimePicker=function(a){this.input_type="charcoal/admin/property/input/datetimepicker",this.input_id=null,this.datetimepicker_selector=null,this.datetimepicker_options=null,this.set_properties(a).create_datetimepicker()},Charcoal.Admin.Property_Input_DateTimePicker.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_DateTimePicker.prototype.constructor=Charcoal.Admin.Property_Input_DateTimePicker,Charcoal.Admin.Property_Input_DateTimePicker.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_DateTimePicker.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.datetimepicker_selector=a.data.datetimepicker_selector||this.datetimepicker_selector,this.datetimepicker_options=a.data.datetimepicker_options||this.datetimepicker_options;var b={};return this.datetimepicker_options=$.extend({},b,this.datetimepicker_options),this},Charcoal.Admin.Property_Input_DateTimePicker.prototype.create_datetimepicker=function(){return $(this.datetimepicker_selector).datetimepicker(this.datetimepicker_options),this},Charcoal.Admin.Property_Input_DualSelect=function(a){this.input_type="charcoal/admin/property/input/dualselect",this.input_id=null,this.dualselect_selector=null,this.dualselect_options={},this._dualselect=null,this.set_properties(a).init()},Charcoal.Admin.Property_Input_DualSelect.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_DualSelect.prototype.constructor=Charcoal.Admin.Property_Input_DualSelect,Charcoal.Admin.Property_Input_DualSelect.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_DualSelect.prototype.init=function(){this.create_dualselect()},Charcoal.Admin.Property_Input_DualSelect.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.dualselect_selector=a.dualselect_selector||a.data.dualselect_selector||this.dualselect_selector,this.dualselect_options=a.dualselect_options||a.data.dualselect_options||this.dualselect_options;var b={keepRenderingSort:!1};return a.data.dualselect_options.searchable&&(this.dualselect_options.search={left:this.dualselect_selector+"_searchLeft",right:this.dualselect_selector+"_searchRight"}),this.dualselect_options=$.extend({},b,this.dualselect_options),this},Charcoal.Admin.Property_Input_DualSelect.prototype.create_dualselect=function(){return $(this.dualselect_selector).multiselect(this.dualselect_options),this},Charcoal.Admin.Property_Input_DualSelect.prototype.set_dualselect=function(a){return this._dualselect=a,this},Charcoal.Admin.Property_Input_DualSelect.prototype.dualselect=function(){return this._dualselect},Charcoal.Admin.Property_Input_DualSelect.prototype.destroy=function(){var a=this.dualselect();a&&a.remove()},Charcoal.Admin.Property_Input_File=function(a){return this.EVENT_NAMESPACE=".charcoal.property.file",this.input_type="charcoal/admin/property/input/file",this.opts=a,this.data=a.data,this.dialog=null,this.set_input_id(this.opts.id),this.init(),this},Charcoal.Admin.Property_Input_File.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_File.prototype.constructor=Charcoal.Admin.Property_Input_File,Charcoal.Admin.Property_Input_File.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_File.prototype.init=function(){return this.input_id?(this.$input=$("#"+this.input_id),this.$file=this.$input.find('input[type="file"]'),this.$hidden=this.$input.find('input[type="hidden"]'),this.$preview=this.$input.find(".js-preview"),window.elFinderCallback||(window.elFinderCallback={}),void this.set_listeners()):this},Charcoal.Admin.Property_Input_File.prototype.set_listeners=function(){return"undefined"==typeof this.$input?this:(this.$input.on("click"+this.EVENT_NAMESPACE,".js-remove-file",this.remove_file.bind(this)).on("click"+this.EVENT_NAMESPACE,".js-elfinder",this.load_elfinder.bind(this)),this.$file.on("change"+this.EVENT_NAMESPACE,this.change_file.bind(this)),void(window.elFinderCallback[this.input_id]=this.elfinder_callback.bind(this)))},Charcoal.Admin.Property_Input_File.prototype.remove_file=function(a){a.preventDefault(),this.$hidden.val(""),this.$input.find(".form-control-static").empty(),this.$input.find(".hide-if-no-file").addClass("hidden")},Charcoal.Admin.Property_Input_File.prototype.change_file=function(a){var b,c,d;b=a.dataTransfer||a.target,c=b&&b.files&&b.files[0],d=URL.createObjectURL(c),this.$input.find(".hide-if-no-file").removeClass("hidden"),this.$input.find(".form-control-static").html(c),
this.$preview.empty()},Charcoal.Admin.Property_Input_File.prototype.load_elfinder=function(a){a.preventDefault(),this.dialog=BootstrapDialog.show({title:this.data.dialog_title||"",size:BootstrapDialog.SIZE_WIDE,cssClass:"-elfinder",message:$('<iframe name="'+this.input_id+'-elfinder" width="100%" height="400px" frameborder="0" src="'+this.data.elfinder_url+'"></iframe>')})},Charcoal.Admin.Property_Input_File.prototype.elfinder_callback=function(a){this.dialog&&this.dialog.close(),a&&a.path&&(this.$input.find(".hide-if-no-file").removeClass("hidden"),this.$input.find(".form-control-static").html(a.name),this.$hidden.val(decodeURI(a.url).replace(Charcoal.Admin.base_url(),"")),this.$preview.empty())},Charcoal.Admin.Property_Input_File.prototype.set_input_id=function(a){return this.input_id=a,this},Charcoal.Admin.Property_Input_File.prototype.set_input_name=function(a){return this.input_name=a,this},Charcoal.Admin.Property_Input_File.prototype.set_input_val=function(a){return this.input_val=a,this},Charcoal.Admin.Property_Input_Image=function(a){return this.EVENT_NAMESPACE=".charcoal.property.image",this.input_type="charcoal/admin/property/input/image",this.opts=a,this.data=a.data,this.set_input_id(this.opts.id),this.init(),this},Charcoal.Admin.Property_Input_Image.prototype=Object.create(Charcoal.Admin.Property_Input_File.prototype),Charcoal.Admin.Property_Input_Image.prototype.constructor=Charcoal.Admin.Property_Input_Image;Charcoal.Admin.Property_Input_Image.prototype.parent=Charcoal.Admin.Property.prototype;Charcoal.Admin.Property_Input_Image.prototype.remove_file=function(a){a.preventDefault(),this.$hidden.val(""),this.$preview.empty(),this.$input.find(".form-control-static").empty(),this.$input.find(".hide-if-no-file").addClass("hidden")},Charcoal.Admin.Property_Input_Image.prototype.change_file=function(a){var b,c,d,e;b=new File,c=a.dataTransfer||a.target,d=c&&c.files&&c.files[0],e=URL.createObjectURL(d),b.src=e,this.$input.find(".hide-if-no-file").removeClass("hidden"),this.$input.find(".form-control-static").html(d),this.$preview.empty().append(b)},Charcoal.Admin.Property_Input_Image.prototype.elfinder_callback=function(a){if(this.dialog&&this.dialog.close(),a&&a.path){var b=$('<img src="'+a.url+'" style="max-width: 100%">');this.$input.find(".hide-if-no-file").removeClass("hidden"),this.$input.find(".form-control-static").html(a.name),this.$hidden.val(decodeURI(a.url).replace(Charcoal.Admin.base_url(),"")),this.$preview.empty().append(b)}},Charcoal.Admin.Property_Input_Map_Widget=function(a){a.input_type="charcoal/admin/property/input/map-widget",Charcoal.Admin.Property.call(this,a);var b=this;this._controller=void 0,this._object_inc=0,"undefined"==typeof google?(window._tmp_google_onload_function=function(){b.init()},$.getScript("https://maps.googleapis.com/maps/api/js?sensor=false&callback=_tmp_google_onload_function&key="+a.data.api_key,function(){})):b.init()},Charcoal.Admin.Property_Input_Map_Widget.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Map_Widget.prototype.constructor=Charcoal.Admin.Property_Input_Map_Widget,Charcoal.Admin.Property_Input_Map_Widget.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Map_Widget.prototype.init=function(){if("undefined"!=typeof window._tmp_google_onload_function&&delete window._tmp_google_onload_function,"undefined"==typeof BB||"undefined"==typeof google)return console.error("Plugins not loaded"),!1;var a=this.data;"undefined"==typeof a.id&&console.error("Missing ID");var b={strokeColor:"#000000",strokeOpacity:.8,strokeWeight:3,fillColor:"#ffffff",fillOpacity:.35,hover:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:2,fillColor:"#ffffff",fillOpacity:.5},focused:{fillOpacity:.8}},c={default_styles:b,use_clusterer:!1,map:{center:{x:45.3712923,y:-73.9820994},zoom:14,mapType:"roadmap",coordsType:"inpage",map_mode:"default"}};c=$.extend(!0,c,a.data);var d=this.element().find("input[type=hidden]").val();if(d){var e=JSON.parse(d),f={},g=0;for(var h in e)g++,f[h]=e[h],f[h].styles=$.extend(e[h].styles,b);f&&(c.places=f),g&&(this._object_inc=g)}this._controller=new window.BB.gmap.controller(this.element().find(".js-map-maker-map").get(0),c),this.controller().init().ready(function(a){a.fit_bounds(),a.remove_focus()}),this.controller().set_styles([{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]}]),this.controller().remove_focus(),this.controls()},Charcoal.Admin.Property_Input_Map_Widget.prototype.controller=function(){return this._controller},Charcoal.Admin.Property_Input_Map_Widget.prototype.object_index=function(){return++this._object_inc},Charcoal.Admin.Property_Input_Map_Widget.prototype.controls=function(){var a=this,b="object";this.element().on("click",".js-add-marker",function(c){c.preventDefault();for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("marker",d)}),this.element().on("click",".js-display-marker-toolbox",function(b){return b.preventDefault(),$(this).hasClass("-active")?($(this).removeClass("-active"),a.hide_marker_toolbar(),!1):($(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active"),void a.display_marker_toolbar())}),this.element().on("click",".js-add-line",function(c){if(c.preventDefault(),$(this).hasClass("-active"))return $(this).removeClass("-active"),!1;$(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active");for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("line",d)}),this.element().on("click",".js-add-polygon",function(c){if(c.preventDefault(),$(this).hasClass("-active"))return $(this).removeClass("-active"),!1;$(this).siblings(".-active").removeClass("-active"),$(this).addClass("-active");for(var d=b+a.object_index();a.controller().get_place(d);)d=b+a.object_index();a.controller().create_new("polygon",d)}),this.element().on("click",".js-add_place_by_address",function(b){b.preventDefault();var c=a.element().find(".js-address").val();return!!c&&void a.controller().add_place_by_address("object"+a.object_index(),c,{type:"marker",draggable:!0,editable:!0,loaded_callback:function(b){a.controller().map().setCenter(b.object().getPosition())}})}),this.element().on("click",".js-reset",function(b){b.preventDefault(),a.controller().reset()}),a.controller().on("focus",function(b){var c=b.data("type");switch(a.element().find(".js-add-polygon").removeClass("-active"),a.element().find(".js-display-marker-toolbox").removeClass("-active"),a.element().find(".js-add-line").removeClass("-active"),c){case"marker":a.element().find(".js-display-marker-toolbox").addClass("-active");break;case"polygon":a.element().find(".js-add-polygon").addClass("-active");break;case"line":a.element().find(".js-add-line").addClass("-active")}})},Charcoal.Admin.Property_Input_Map_Widget.prototype.display_marker_toolbar=function(){$(".c-map-maker ").addClass("maker_header-open")},Charcoal.Admin.Property_Input_Map_Widget.prototype.hide_marker_toolbar=function(){$(".c-map-maker ").removeClass("maker_header-open")},Charcoal.Admin.Property_Input_Map_Widget.prototype.save=function(){var a=this.controller().export(),b="object"==typeof a.places?a.places:{};return this.element().find("input[type=hidden]").val(JSON.stringify(b)),this},Charcoal.Admin.Property_Input_SelectPicker=function(a){this.input_type="charcoal/admin/property/input/select",this.input_id=null,this.select_selector=null,this.select_options=null,this.set_properties(a).create_select()},Charcoal.Admin.Property_Input_SelectPicker.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_SelectPicker.prototype.constructor=Charcoal.Admin.Property_Input_SelectPicker,Charcoal.Admin.Property_Input_SelectPicker.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_SelectPicker.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.select_selector=a.data.select_selector||this.select_selector,this.select_options=a.data.select_options||this.select_options;var b={};return this.select_options=$.extend({},b,this.select_options),this},Charcoal.Admin.Property_Input_SelectPicker.prototype.create_select=function(){return $(this.select_selector).selectpicker(this.select_options),this},Selectize.define("create_on_blur",function(){if("multi"===this.settings.mode){var a=this;this.onBlur=function(){var b=a.onBlur;return function(){return""!==this.$control_input.val().trim()&&a.createItem(this.$control_input.val()),b.apply(this,arguments)}}()}}),Selectize.define("create_on_enter",function(){if("multi"===this.settings.mode){var a=this;this.onKeyUp=function(){var b=a.onKeyUp;return function(c){return 13===c.keyCode&&""!==this.$control_input.val().trim()&&a.createItem(this.$control_input.val()),b.apply(this,arguments)}}()}}),Selectize.define("charcoal_item",function(a){a=$.extend({classField:"class",colorField:"color"},a);var b=this;this.settings.onItemAdd=function(){var c=null;return b.settings.hasOwnProperty("onItemAdd")&&(c=b.settings.onItemAdd),function(d,e){var f=b.options[d];if(f.hasOwnProperty(a.colorField)&&e.css("background-color",f[a.colorField]),f.hasOwnProperty(a.classField)&&e.addClass(f[a.classField]),c)return c.apply(this,arguments)}}()}),Charcoal.Admin.Property_Input_Selectize_Tags=function(a){this.input_type="charcoal/admin/property/input/selectize/tags",this.input_id=null,this.obj_type=null,this.copy_items=!1,this.title=null,this.multiple=!1,this.separator=",",this._tags=null,this.selectize=null,this.selectize_selector=null,this.selectize_options={},this.clipboard=null,this.set_properties(a).init()},Charcoal.Admin.Property_Input_Selectize_Tags.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Selectize_Tags.prototype.constructor=Charcoal.Admin.Property_Input_Selectize_Tags,Charcoal.Admin.Property_Input_Selectize_Tags.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Selectize_Tags.prototype.init=function(){if("function"!=typeof $.fn.sortable){var a="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js";return Charcoal.Admin.loadScript(a,this.init.bind(this)),this}this.init_selectize(),this.init_clipboard()},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.set_properties=function(a){this.input_id=a.id||this.input_id,this.obj_type=a.data.obj_type||this.obj_type,this.copy_items=a.data.copy_items||this.copy_items,this.title=a.data.title||this.title,this.multiple=a.data.multiple||this.multiple,this.separator=a.data.multiple_separator||this.multiple_separator||",",this.selectize_selector=a.data.selectize_selector||this.selectize_selector,this.selectize_options=a.data.selectize_options||this.selectize_options,this.$input=$(this.selectize_selector||"#"+this.input_id);var b;b=this.multiple?["remove_button","drag_drop","charcoal_item"]:["charcoal_item"];var c=this.obj_type,d={plugins:b,formData:{},delimiter:this.separator,persist:!1,preload:!0,openOnFocus:!0,dropdownParent:this.$input.closest(".form-field"),createFilter:function(a){for(var b in this.options)if(b=this.options[b],b.text===a)return!1;return!0},onInitialize:function(){var a=this;a.sifter.iterator(this.items,function(b){var c=a.options[b],d=a.getItem(b);c.color&&d.css("background-color",c.color)})}};if(c?(d.create=this.create_tag.bind(this),d.load=this.load_tags.bind(this)):(d.plugins.push("create_on_enter"),d.create=function(a){return{value:a,text:a}}),this.selectize_options=$.extend({},d,this.selectize_options),this.selectize_options.splitOn){var e=this.selectize_options.splitOn;if("array"===$.type(e)){for(var f=e.length-1;f>=0;f--)switch(e[f]){case"comma":e[f]="\\s*,\\s*";break;case"tab":e[f]="\\t+";break;default:e[f]=e[f].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}e=e.join("|")}this.selectize_options.splitOn=new RegExp(e)}return this},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.create_tag=function(a,b){var c=this.obj_type,d=this.id,e=this.title,f=this.selectize_options,g={};$.isEmptyObject(f.formData)?g={name:a}:(g=$.extend({},f.formData),$.each(g,function(b,c){":input"===c&&(g[b]=a)}));var h={title:e,size:BootstrapDialog.SIZE_WIDE,cssClass:"-quick-form",dialog_options:{onhide:function(){b({return:!1})}},widget_type:"charcoal/admin/widget/quickForm",widget_options:{obj_type:c,obj_id:d,form_data:g}};this.dialog(h,function(a){if(a.success){if(!a.widget_id)return!1;Charcoal.Admin.manager().add_widget({id:a.widget_id,type:"charcoal/admin/widget/quick-form",data:{obj_type:c},obj_id:d,save_callback:function(a){b({value:a.obj.id,text:a.obj.name[Charcoal.Admin.lang]||a.obj.name||a.obj.id,color:a.obj.color,class:"new"}),BootstrapDialog.closeAll()}})}})},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.load_tags=function(a,b){var c=this.obj_type;return a.length?void $.ajax({url:Charcoal.Admin.admin_url()+"object/load",data:{obj_type:c},type:"GET",error:function(){b()},success:function(a){var c=[];for(var d in a.collection)d=a.collection[d],c.push({value:d.id,text:d.name[Charcoal.Admin.lang]||d.name||d.id,color:d.color});b(c)}}):b()},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.dialog=Charcoal.Admin.Widget.prototype.dialog,Charcoal.Admin.Property_Input_Selectize_Tags.prototype.onKeyDown=function(a){var b=this,c=!1,d=/Mac/.test(navigator.userAgent);if(b.isLocked&&9!==a.keyCode&&a.preventDefault(),"undefined"===$.type(b.isCmdDown)&&(c=!0,b.isCmdDown=a[d?"metaKey":"ctrlKey"]),b.isCmdDown&&67===a.keyCode){if(c&&(b.isCmdDown=void 0),b.$activeItems.length)for(var e=[],f=0,g=b.$activeItems.length;f<g;f++)e.push($(b.$activeItems[f]).attr("data-value")),document.execCommand("copy")}else if((b.isFull()||b.isInputHidden)&&!(d?a.metaKey:a.ctrlKey))return void a.preventDefault()},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.init_selectize=function(){var a=this.$input.selectize(this.selectize_options);this.selectize=a[0].selectize},Charcoal.Admin.Property_Input_Selectize_Tags.prototype.init_clipboard=function(){if(this.copy_items){var a=this.selectize;this.clipboard=new Clipboard(this.selectize_selector+"_copy",{text:function(){return a.$input.val()}})}},Charcoal.Admin.Property_Input_Switch=function(a){this.input_type="charcoal/admin/property/input/switch",this.input_id=null,this.input_selector=null,this.switch_selector=null,this.switch_options=null,this.set_properties(a).create_switch()},Charcoal.Admin.Property_Input_Switch.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Switch.prototype.constructor=Charcoal.Admin.Property_Input_Switch,Charcoal.Admin.Property_Input_Switch.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Switch.prototype.set_properties=function(a){var b=this;this.input_id=a.id||this.input_id,this.input_selector=a.data.input_selector||this.input_selector,this.switch_selector=a.data.switch_selector||this.switch_selector,this.switch_options=a.data.switch_options||this.switch_options;var c={},d={onSwitchChange:function(a,c){$(b.input_selector).val(c?1:0)}};return this.switch_options=$.extend({},c,this.switch_options,d),this},Charcoal.Admin.Property_Input_Switch.prototype.create_switch=function(){return $(this.switch_selector).bootstrapSwitch(this.switch_options),this},Charcoal.Admin.Property_Input_Text=function(a){return this.input_type="charcoal/admin/property/input/text",this.opts=a,this.data=a.data,this.set_input_id(this.opts.id),this.set_data(this.data),this.init(),this},Charcoal.Admin.Property_Input_Text.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Text.prototype.constructor=Charcoal.Admin.Property_Input_Text,Charcoal.Admin.Property_Input_Text.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Text.prototype.set_data=function(a){return this.set_input_name(a.input_name),this.set_input_val(a.input_val),this.set_readonly(a.readonly),this.set_required(a.required),this.set_min_length(a.min_length),this.set_max_length(a.max_length),this.set_size(a.size),this.set_multiple(a.multiple),this.set_multiple_separator(a.multiple_separator),this},Charcoal.Admin.Property_Input_Text.prototype.init=function(){return this.input_id?(this.$input=$("#"+this.input_id),void(this.multiple&&this.init_multiple())):this},Charcoal.Admin.Property_Input_Text.prototype.init_multiple=function(){return this.chars_new=[13],this.chars_remove=[8,46],this.char_next=[40],this.char_prev=[38],this.$container=this.$input.parent("div"),this.bind_keyboard_events(this.$input),this.split_val(this.$input),this},Charcoal.Admin.Property_Input_Text.prototype.split_val=function(a){var b=this.multiple_separator;a=a||this.$input;var c=a.val(),d=c.split(b),e=0,f=d.length;if(1===f)return!1;for(;e<f;e++)0===e?a.val(d[e]):a=this.insert_item(a,d[e]);return this},Charcoal.Admin.Property_Input_Text.prototype.bind_keyboard_events=function(a){var b=this,c=this.chars_new,d=this.chars_remove,e=this.char_next,f=this.char_prev;a.on("keydown",function(a){var g=a.keyCode;c.indexOf(g)>-1&&(a.preventDefault(),b.insert_item($(this))),d.indexOf(g)>-1&&""===$(this).val()&&(a.preventDefault(),b.remove_item($(this))),f.indexOf(g)>-1&&(a.preventDefault(),$(this).prev("input").focus()),e.indexOf(g)>-1&&(a.preventDefault(),$(this).next("input").focus())}),a.on("keyup",function(){b.split_val($(this))})},Charcoal.Admin.Property_Input_Text.prototype.insert_item=function(a,b){var c=this.input_clone(b);return c.insertAfter(a),this.bind_keyboard_events(c),c.focus(),c},Charcoal.Admin.Property_Input_Text.prototype.add_item=function(a){var b=this.input_clone(a);return this.$container.append(b),this.bind_keyboard_events(b),b.focus(),b},Charcoal.Admin.Property_Input_Text.prototype.remove_item=function(a){var b=a.prev("input"),c=a.next("input");return!(!b.length&&!c.length)&&(b.length?b.focus():c.length&&c.focus(),this.remove_item_listeners(a),a.remove(),this)},Charcoal.Admin.Property_Input_Text.prototype.remove_item_listeners=function(a){return a.off("keydown"),a.off("keyup"),this},Charcoal.Admin.Property_Input_Text.prototype.input_clone=function(a){var b=this.$input,c=b.attr("class"),d=this.min_length,e=this.max_length,f=this.required,g=this.readonly,h=this.input_name,i=$('<input type="text" />');return c&&i.attr("class",c),d&&i.attr("minlength",d),e&&i.attr("maxlength",e),f&&i.attr("required","required"),g&&i.attr("read_only","read_only"),a&&i.val(a),i.attr("name",h),i},Charcoal.Admin.Property_Input_Text.prototype.set_input_id=function(a){return this.input_id=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_input_name=function(a){return this.input_name=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_input_val=function(a){return this.input_val=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_readonly=function(a){return a||(a=!1),this.readonly=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_required=function(a){return a||(a=!1),this.required=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_min_length=function(a){return a||(a=0),this.min_length=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_max_length=function(a){return a||(a=0),this.max_length=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_size=function(a){return a||(a=0),this.size=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_multiple=function(a){return a||(a=!1),this.multiple=a,this},Charcoal.Admin.Property_Input_Text.prototype.set_multiple_separator=function(a){return a||(a=","),this.multiple_separator=a,this},Charcoal.Admin.Property_Input_Tinymce=function(a){this.input_type="charcoal/admin/property/input/tinymce",this.input_id=null,this.data=a.data,this.editor_options=null,this._editor=null,window.elFinderCallback||(window.elFinderCallback={}),this.set_properties(a),this.init()},Charcoal.Admin.Property_Input_Tinymce.prototype=Object.create(Charcoal.Admin.Property.prototype),Charcoal.Admin.Property_Input_Tinymce.prototype.constructor=Charcoal.Admin.Property_Input_Tinymce,Charcoal.Admin.Property_Input_Tinymce.prototype.parent=Charcoal.Admin.Property.prototype,Charcoal.Admin.Property_Input_Tinymce.prototype.init=function(){this.create_tinymce()},Charcoal.Admin.Property_Input_Tinymce.prototype.base_url=function(){return Charcoal.Admin.base_url()+"assets/admin/scripts/vendors/tinymce"},Charcoal.Admin.Property_Input_Tinymce.prototype.set_properties=function(a){this.input_id=a.input_id||this.input_id,this.editor_options=a.editor_options||a.data.editor_options||this.editor_options,window.elFinderCallback[this.input_id]=this.elfinder_callback.bind(this);var b={plugins:["advlist","anchor","autolink","autoresize","charcoal","charmap","code","colorpicker","contextmenu","fullscreen","hr","image","link","lists","media","nonbreaking","noneditable","paste","searchreplace","tabfocus","table","visualblocks","visualchars","wordcount"],toolbar:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image anchor",browser_spellcheck:!0,end_container_on_empty_block:!0,entity_encoding:"raw",allow_conditional_comments:!0,convert_fonts_to_spans:!0,forced_root_block:"p",allow_script_urls:!1,document_base_url:Charcoal.Admin.base_url(),relative_urls:!0,remove_script_host:!1,autoresize_min_height:"150px",autoresize_max_height:"400px",contextmenu:"link image inserttable | cell row column deletetable",file_picker_callback:$.proxy(this.elfinder_browser,null,this),image_advtab:!0,importcss_append:!0,media_alt_source:!1,nonbreaking_force_tab:!1,paste_data_images:!0,paste_as_text:!0,paste_merge_formats:!0,root_lang_attr:$("#"+this.input_id).closest("[data-lang]").data("lang"),table_grid:!0,table_tab_navigation:!0,visualblocks_default_state:!1};return"plugins"in b&&"plugins"in this.editor_options&&($.each(this.editor_options.plugins,function(a,c){var d,e=0===c.indexOf("!");if(e&&(c=c.slice(1)),e)for(;(d=b.plugins.indexOf(c))>-1;)delete b.plugins[d];else b.plugins.indexOf(c)===-1&&b.plugins.push(c)}),delete this.editor_options.plugins),this.editor_options=$.extend({},b,this.editor_options),this.editor_options.selector="#"+this.input_id,this.editor_options.setup=function(a){a.on("change",function(){window.tinymce.triggerSave()})},this},Charcoal.Admin.Property_Input_Tinymce.prototype.create_tinymce=function(){var a=this;if("object"!=typeof window.tinyMCE){var b=this.base_url()+"/tinymce.min.js";return Charcoal.Admin.loadScript(b,this.create_tinymce.bind(this)),this}window.tinyMCE.dom.Event.domLoaded=!0,window.tinyMCE.baseURI=new window.tinyMCE.util.URI(this.base_url()),window.tinyMCE.baseURL=this.base_url(),window.tinyMCE.suffix=".min",window.tinyMCE.PluginManager.get(this.input_id)||(window.tinyMCE.PluginManager.add(this.input_id,function(b){a.set_editor(b)}),"array"!==$.type(this.editor_options.plugins)&&(this.editor_options.plugins=[]),this.editor_options.plugins.push(this.input_id)),window.tinyMCE.init(this.editor_options)},Charcoal.Admin.Property_Input_Tinymce.prototype.elfinder_callback=function(a,b){parent.tinyMCE.activeEditor.windowManager.getParams().oninsert(a,b),parent.tinyMCE.activeEditor.windowManager.close()},Charcoal.Admin.Property_Input_Tinymce.prototype.elfinder_browser=function(a,b,c,d){var e=this;return window.tinyMCE.activeEditor.windowManager.open({file:a.data.elfinder_url+"&"+$.param(d),title:a.data.dialog_title||"",width:900,height:450,resizable:"yes"},{oninsert:function(a,c){var f,g,h,i;for(f=a.url,g=/\/[^\/]+?\/\.\.\//;f.match(g);)f=f.replace(g,"/");i=e.selection.getContent(),0===i.length&&"A"===e.selection.getNode().nodeName&&(i=e.selection.getNode().textContent),h=a.name+" ("+c.formatSize(a.size)+")","file"===d.filetype&&b(f,{text:i||h,title:h}),"image"===d.filetype&&b(f,{alt:h}),"media"===d.filetype&&b(f)}}),!1},Charcoal.Admin.Property_Input_Tinymce.prototype.set_editor=function(a){return this._editor=a,this},Charcoal.Admin.Property_Input_Tinymce.prototype.editor=function(){return this._editor},Charcoal.Admin.Property_Input_Tinymce.prototype.destroy=function(){var a=this.editor();a&&a.remove()},Charcoal.Admin.Template=function(a){window.alert("Template "+a)},Charcoal.Admin.Template_Login=function(a){this.template_type="charcoal/admin/template/login",this.init(a)},Charcoal.Admin.Template_Login.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Login.prototype.constructor=Charcoal.Admin.Template_Login,Charcoal.Admin.Template_Login.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Login.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Login.prototype.bind_events=function(){$(".js-login-submit").on("click",function(a){a.preventDefault();var b=$(this).parents("form"),c=Charcoal.Admin.admin_url()+"login",d=b.serialize();$.post(c,d,function(a){window.console.debug(a),a.success?window.location.href=a.next_url:BootstrapDialog.show({title:"Login error",message:"Authentication failed. Please try again.",type:BootstrapDialog.TYPE_DANGER})},"json").fail(function(){BootstrapDialog.show({title:"Login error",message:"Authentication failed. Please try again.",type:BootstrapDialog.TYPE_DANGER})})})},Charcoal.Admin.Template_MenuHeader=function(){$(".js-toggle-class").click(function(a){a.preventDefault();var b=$(this),c=b.data("class"),d=b.data("target");$(d).toggleClass(c)}),$(document).on("click",".js-accordion-header",function(a){a.preventDefault();var b=$(this);b.toggleClass("is-open").siblings(".js-accordion-content").stop().slideToggle()})},Charcoal.Admin.Template_Account_LostPassword=function(a){this.template_type="charcoal/admin/template/account/lost-password",this.init(a)},Charcoal.Admin.Template_Account_LostPassword.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Account_LostPassword.prototype.constructor=Charcoal.Admin.Template_Account_LostPassword,Charcoal.Admin.Template_Account_LostPassword.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Account_LostPassword.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Account_LostPassword.prototype.bind_events=function(){$(".js-lost-password-submit").on("click",function(a){a.preventDefault();var b=$(this).parents("form");console.debug(b.attr("action"));var c=Charcoal.Admin.admin_url()+"account/lost-password",d=b.serialize();$.post(c,d,function(a){window.console.debug(a),BootstrapDialog.show({title:"Password request sent",message:"If any user matches the username or email given, a password request link will be sent to the email adress linked with account. \nThe link will be valid for 15 minutes.",type:BootstrapDialog.TYPE_SUCCESS,onhidden:function(){window.location.reload()}})},"json").fail(function(){BootstrapDialog.show({title:"Lost password error",message:"There was an error attempting to retrieve lost password.",type:BootstrapDialog.TYPE_DANGER,onhidden:function(){window.grecaptcha.reset()}})})})},Charcoal.Admin.Template_Account_ResetPassword=function(a){this.template_type="charcoal/admin/template/account/reset-password",this.init(a)},Charcoal.Admin.Template_Account_ResetPassword.prototype=Object.create(Charcoal.Admin.Template.prototype),Charcoal.Admin.Template_Account_ResetPassword.prototype.constructor=Charcoal.Admin.Template_Account_ResetPassword,Charcoal.Admin.Template_Account_ResetPassword.prototype.parent=Charcoal.Admin.Template.prototype,Charcoal.Admin.Template_Account_ResetPassword.prototype.init=function(a){window.console.debug(a),this.bind_events()},Charcoal.Admin.Template_Account_ResetPassword.prototype.bind_events=function(){$(".js-reset-password-submit").on("click",function(a){a.preventDefault();var b=$(this).parents("form"),c=Charcoal.Admin.admin_url()+"account/reset-password",d=b.serialize();$.post(c,d,function(a){window.console.debug(a),BootstrapDialog.show({title:"Password reset",message:"The password was successfully reset.",type:BootstrapDialog.TYPE_SUCCESS,onhidden:function(){window.location.href=Charcoal.Admin.admin_url()+"login"}})},"json").fail(function(){BootstrapDialog.show({title:"Reset password error",message:"There was an error attempting to reset password.",type:BootstrapDialog.TYPE_DANGER,onhidden:function(){window.grecaptcha.reset()}})})})};